// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL") // Descomenta si usas un Connection Pooler en Neon
}

model Customer {
  id        String    @id @default(uuid())
  firstName String
  lastName  String
  email     String?   @unique
  phone     String    @unique
  addresses Address[]
  orders    Order[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Address {
  id            String   @id @default(uuid())
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  streetAddress String
  comuna        String
  instructions  String?
  orders        Order[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum PaymentStatus {
  pending
  paid
  rejected
  refunded
  charged_back
}

enum FulfillmentStatus {
  new
  preparing
  shipped
  delivered
  cancelled
}

model Order {
  id              String            @id @default(uuid())
  orderNumber     String?           @unique
  customerId      String
  customer        Customer          @relation(fields: [customerId], references: [id])
  addressId       String
  address         Address           @relation(fields: [addressId], references: [id])
  siteId          String
  packageContents String
  packagePieces   Int               @default(1)
  paymentStatus   PaymentStatus     @default(pending)
  fulfillmentStatus FulfillmentStatus @default(new)
  payments        Payment[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
}

enum PaymentProviderStatus {
  pending
  approved
  rejected
  refunded
  charged_back
  cancelled
}

model Payment {
  id                String                @id @default(uuid())
  orderId           String
  order             Order                 @relation(fields: [orderId], references: [id])
  provider          String
  providerPaymentId String                @unique
  status            PaymentProviderStatus @default(pending)
  amount            Int
  createdAt         DateTime              @default(now())
}

model EmailTemplate {
  id             String   @id @default(uuid())
  slug           String   @unique // e.g., 'purchase-confirmation'
  name           String   // Human readable name
  subject        String
  body           String   @db.Text
  defaultSubject String
  defaultBody    String   @db.Text
  placeholders   String[] // List of available placeholders for this template
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Product {
  id          String   @id @default(uuid())
  slug        String   @unique
  name        String
  description String   @db.Text
  price       Int
  currency    String   @default("CLP")
  active      Boolean  @default(true)
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
