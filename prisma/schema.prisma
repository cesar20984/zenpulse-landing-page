generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        String    @id @default(uuid())
  firstName String
  lastName  String
  email     String?   @unique
  phone     String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  addresses Address[]
  orders    Order[]
}

model Address {
  id            String   @id @default(uuid())
  customerId    String
  streetAddress String
  comuna        String
  instructions  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  customer      Customer @relation(fields: [customerId], references: [id])
  orders        Order[]
}

model Order {
  id                String            @id @default(uuid())
  orderNumber       String?           @unique
  customerId        String
  addressId         String
  siteId            String
  packageContents   String
  packagePieces     Int               @default(1)
  paymentStatus     PaymentStatus     @default(pending)
  fulfillmentStatus FulfillmentStatus @default(new)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  address           Address           @relation(fields: [addressId], references: [id])
  customer          Customer          @relation(fields: [customerId], references: [id])
  payments          Payment[]
}

model Payment {
  id                String                @id @default(uuid())
  orderId           String
  provider          String
  providerPaymentId String                @unique
  status            PaymentProviderStatus @default(pending)
  amount            Int
  createdAt         DateTime              @default(now())
  order             Order                 @relation(fields: [orderId], references: [id])
}

model EmailTemplate {
  id             String   @id @default(uuid())
  slug           String   @unique
  name           String
  subject        String
  body           String
  defaultSubject String
  defaultBody    String
  placeholders   String[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model GlobalSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PaymentStatus {
  pending
  paid
  rejected
  refunded
  charged_back
}

enum FulfillmentStatus {
  new
  preparing
  shipped
  delivered
  cancelled
}

enum PaymentProviderStatus {
  pending
  approved
  rejected
  refunded
  charged_back
  cancelled
}
